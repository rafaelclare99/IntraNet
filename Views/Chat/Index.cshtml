@{
    ViewData["Title"] = "Chat Interno";
}

<h2>Chat Interno</h2>

<div id="chatBox" class="border rounded p-3 mb-3" style="height:300px; overflow-y:auto;">
</div>

<div class="input-group">
    <input type="text" id="messageInput" class="form-control" placeholder="Digite sua mensagem..." />
    <button class="btn btn-success" onclick="enviarMensagem()">Enviar</button>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/chatHub")
            .build();

        connection.on("ReceberMensagem", function (usuario, mensagem, hora) {
            const msg = document.createElement("div");
            msg.innerHTML = `<strong>${usuario}</strong> [${hora}]: ${mensagem}`;
            document.getElementById("chatBox").appendChild(msg);
        });

        connection.start();

        function enviarMensagem() {
            const input = document.getElementById("messageInput");
            if (input.value.trim() === "") return;

            connection.invoke("EnviarMensagem", input.value);
            input.value = "";
        }
    </script>
}
